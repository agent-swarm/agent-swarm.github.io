<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/31_integration_tests | agent-swarm-kit</title><meta name="description" content="Documentation for agent-swarm-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">agent-swarm-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">agent-swarm-kit</a></li><li><a href="design_31_integration_tests.html">design/31_integration_tests</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="integration-tests" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Integration Tests<a href="#integration-tests" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The integration test suite validates the complete agent-swarm-kit system by testing interactions between agents, swarms, sessions, tools, and the underlying service infrastructure. These tests ensure that all components work together correctly under various scenarios including concurrent operations, error conditions, and resource management.</p>
<p>For information about test utilities and mock services, see <a href="design_07_storage_and_state.html">Test Utilities</a>.</p>
<a id="test-framework-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Test Framework Architecture<a href="#test-framework-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The integration tests use the <code>worker-testbed</code> framework and are organized into focused test suites that validate specific system behaviors. Each test creates a complete system configuration including agents, completions, tools, and swarms.</p>
<p><img src="../media/31_Integration_Tests_0.svg" alt="Mermaid Diagram"></p>
<a id="connection-and-session-testing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Connection and Session Testing<a href="#connection-and-session-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The connection tests validate concurrent session management, message queuing, and event handling across multiple client connections. These tests ensure the system maintains proper isolation between clients while handling parallel operations.</p>
<a id="connection-test-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Connection Test Patterns<a href="#connection-test-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/31_Integration_Tests_1.svg" alt="Mermaid Diagram"></p>
<a id="key-connection-test-cases" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Key Connection Test Cases<a href="#key-connection-test-cases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Test Case</th>
<th>Purpose</th>
<th>Key Functions Tested</th>
</tr>
</thead>
<tbody>
<tr>
<td>Parallel Complete Calls</td>
<td>Validates session isolation</td>
<td><code>complete</code>, <code>randomString</code>, <code>Promise.all</code></td>
</tr>
<tr>
<td>Connection Orchestration</td>
<td>Tests swarm navigation</td>
<td><code>changeToAgent</code>, <code>execute</code>, <code>session</code></td>
</tr>
<tr>
<td>Message Queuing</td>
<td>Ensures ordered processing</td>
<td><code>complete</code>, <code>getRawHistory</code>, <code>setConfig</code></td>
</tr>
<tr>
<td>Event System</td>
<td>Validates event handling</td>
<td><code>makeConnection</code>, <code>listenEvent</code>, <code>event</code></td>
</tr>
</tbody>
</table>
<a id="navigation-and-tool-execution-testing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Navigation and Tool Execution Testing<a href="#navigation-and-tool-execution-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Navigation tests validate agent transitions, tool execution, and deadlock prevention mechanisms. These tests use a triage-sales-refund agent pattern to simulate real-world navigation scenarios.</p>
<a id="navigation-test-architecture" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Navigation Test Architecture<a href="#navigation-test-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/31_Integration_Tests_2.svg" alt="Mermaid Diagram"></p>
<a id="navigation-test-scenarios" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Navigation Test Scenarios<a href="#navigation-test-scenarios" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The navigation tests cover several critical scenarios:</p>
<ol>
<li><strong>Basic Navigation</strong>: Tests <code>changeToAgent</code> and <code>execute</code> for moving between agents</li>
<li><strong>Default Agent Return</strong>: Validates <code>changeToDefaultAgent</code> functionality</li>
<li><strong>Previous Agent Navigation</strong>: Tests <code>changeToPrevAgent</code> for navigation history</li>
<li><strong>Deadlock Prevention</strong>: Ensures <code>commitToolOutput</code> prevents execution blocking</li>
</ol>
<a id="resource-management-and-disposal-testing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Resource Management and Disposal Testing<a href="#resource-management-and-disposal-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Disposal tests validate proper cleanup of sessions, connections, and associated resources. These tests ensure no memory leaks occur when connections are terminated.</p>
<a id="disposal-test-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Disposal Test Flow<a href="#disposal-test-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/31_Integration_Tests_3.svg" alt="Mermaid Diagram"></p>
<a id="error-recovery-and-rescue-testing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Error Recovery and Rescue Testing<a href="#error-recovery-and-rescue-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The rescue tests validate error handling mechanisms when tools fail, completions return empty responses, or validation fails. These tests use the <code>CC_RESQUE_STRATEGY</code> configuration to control error recovery behavior.</p>
<a id="rescue-test-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Rescue Test Patterns<a href="#rescue-test-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Error Condition</th>
<th>Test Method</th>
<th>Expected Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td>Non-existent Tool Call</td>
<td>Mock completion returns invalid tool</td>
<td>System returns placeholder from <code>CC_EMPTY_OUTPUT_PLACEHOLDERS</code></td>
</tr>
<tr>
<td>Empty Completion Response</td>
<td>Mock completion returns empty content</td>
<td>System applies rescue strategy</td>
</tr>
<tr>
<td>Failed Tool Validation</td>
<td>Tool validation returns false</td>
<td>System prevents tool execution and applies rescue</td>
</tr>
</tbody>
</table>
<a id="validation-testing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Validation Testing<a href="#validation-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Validation tests ensure the dependency injection system properly validates component dependencies before allowing system operations. These tests verify that missing components are detected and reported.</p>
<a id="validation-test-matrix" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Validation Test Matrix<a href="#validation-test-matrix" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><img src="../media/31_Integration_Tests_4.svg" alt="Mermaid Diagram"></p>
<a id="message-filtering-and-agent-state-testing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Message Filtering and Agent State Testing<a href="#message-filtering-and-agent-state-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The ignore tests validate that messages are properly filtered based on agent state, ensuring that only the active agent processes messages while inactive agents ignore execution requests.</p>
<a id="agent-state-test-flow" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Agent State Test Flow<a href="#agent-state-test-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The system maintains agent state per client session and filters messages based on the currently active agent:</p>
<ol>
<li><strong>Execute Filtering</strong>: <code>execute(message, clientId, agent)</code> only processes when the specified agent is active</li>
<li><strong>Tool Output Filtering</strong>: <code>commitToolOutput(toolId, output, clientId, agent)</code> only commits from active agents</li>
<li><strong>System Message Filtering</strong>: <code>commitSystemMessage(message, clientId, agent)</code> only processes from active agents</li>
</ol>
<a id="test-data-management" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Test Data Management<a href="#test-data-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Integration tests use several strategies for managing test data and ensuring test isolation:</p>
<ul>
<li><strong>Random Client IDs</strong>: Each test uses <code>randomString()</code> to generate unique client identifiers</li>
<li><strong>Mock Completions</strong>: Tests create predictable AI responses using <code>addCompletion</code> with custom logic</li>
<li><strong>Configuration Control</strong>: Tests use <code>setConfig()</code> to modify system behavior for specific scenarios</li>
<li><strong>History Validation</strong>: Tests use <code>getRawHistory(clientId)</code> to verify message ordering and content</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#integration-tests"><span>Integration <wbr/>Tests</span></a><ul><li><a href="#test-framework-architecture"><span>Test <wbr/>Framework <wbr/>Architecture</span></a></li><li><a href="#connection-and-session-testing"><span>Connection and <wbr/>Session <wbr/>Testing</span></a></li><li><ul><li><a href="#connection-test-patterns"><span>Connection <wbr/>Test <wbr/>Patterns</span></a></li><li><a href="#key-connection-test-cases"><span>Key <wbr/>Connection <wbr/>Test <wbr/>Cases</span></a></li></ul></li><li><a href="#navigation-and-tool-execution-testing"><span>Navigation and <wbr/>Tool <wbr/>Execution <wbr/>Testing</span></a></li><li><ul><li><a href="#navigation-test-architecture"><span>Navigation <wbr/>Test <wbr/>Architecture</span></a></li><li><a href="#navigation-test-scenarios"><span>Navigation <wbr/>Test <wbr/>Scenarios</span></a></li></ul></li><li><a href="#resource-management-and-disposal-testing"><span>Resource <wbr/>Management and <wbr/>Disposal <wbr/>Testing</span></a></li><li><ul><li><a href="#disposal-test-flow"><span>Disposal <wbr/>Test <wbr/>Flow</span></a></li></ul></li><li><a href="#error-recovery-and-rescue-testing"><span>Error <wbr/>Recovery and <wbr/>Rescue <wbr/>Testing</span></a></li><li><ul><li><a href="#rescue-test-patterns"><span>Rescue <wbr/>Test <wbr/>Patterns</span></a></li></ul></li><li><a href="#validation-testing"><span>Validation <wbr/>Testing</span></a></li><li><ul><li><a href="#validation-test-matrix"><span>Validation <wbr/>Test <wbr/>Matrix</span></a></li></ul></li><li><a href="#message-filtering-and-agent-state-testing"><span>Message <wbr/>Filtering and <wbr/>Agent <wbr/>State <wbr/>Testing</span></a></li><li><ul><li><a href="#agent-state-test-flow"><span>Agent <wbr/>State <wbr/>Test <wbr/>Flow</span></a></li></ul></li><li><a href="#test-data-management"><span>Test <wbr/>Data <wbr/>Management</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">agent-swarm-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(100273846, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        ecommerce:"dataLayer"
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/100273846" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-85RYYZDT35"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-85RYYZDT35');
</script>
