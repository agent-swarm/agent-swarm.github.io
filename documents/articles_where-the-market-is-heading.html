<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>articles/where-the-market-is-heading | agent-swarm-kit</title><meta name="description" content="Documentation for agent-swarm-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">agent-swarm-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">agent-swarm-kit</a></li><li><a href="articles_where-the-market-is-heading.html">articles/where-the-market-is-heading</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="where-the-market-is-heading" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Where the Market is Heading<a href="#where-the-market-is-heading" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Long ago, the graphical user interface replaced console input. It might seem that a pseudo-graphical interface could solve the inconvenience for untrained users, but there’s a factor not everyone notices.</p>
<p><img src="../media/35ad3309015a460ae4bd96b06e44b116.png" alt="Pseudo-Graphical Interface"><br>
<em>Pseudo-Graphical Interface</em></p>
<p><strong>Important!</strong> Developing a graphical user interface is cheaper than a pseudo-graphical one. Historically, right after the release of the NeXT CUBE, the ObjC language was introduced with a graphical form editor, allowing pages to be assembled with a mouse. In the modern world, Frontend offers graphical form debugging via Dev Tools, which is roughly the same: nominal code without technical details, and when issues arise, there’s a GUI that simplifies bug hunting.</p>
<p><img src="../media/5e57a85df60ef287a6da5d470141dc35.png" alt="Graphical Interface"><br>
<em>Graphical Interface</em></p>
<p>But it’s even cheaper to skip creating a user interface altogether. You don’t need a static IP, PCI DSS compliance, a domain promoted on Yandex or Google, or high-load infrastructure if you decide not to reinvent the wheel or build yet another web product—where attracting visitors would cost three times more than development.</p>
<p><img src="../media/35c9f26d812fce687fc6ebdc6eaced44.png" alt="Voice Interface"><br>
<em>Voice Interface</em></p>
<p>A phone is derived from &quot;phono,&quot; phonetics—sound. Instead of learning countless button combinations for Figma, Blender, Photoshop, or Unreal Engine, it’s easier to simply voice a command: <em>“How do I rotate a drawing in ArchiCAD?”</em></p>
<a id="llm-as-a-new-type-of-user-interface" class="tsd-anchor"></a><h2 class="tsd-anchor-link">LLM as a New Type of User Interface<a href="#llm-as-a-new-type-of-user-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p><a href="https://github.com/openai/swarm">Agent Swarm</a> is like fragments in Android or a router in React: it allows task scopes (screen buttons) to be specified based on prior user input. For example, when a call comes to a SIP phone, you first need to determine whether the person wants to buy or return an item, then offer them a list of available products for purchase.</p>
<p><img src="../media/e6d5ff2299554ca23d1402f8c5702848.png" alt="Data Schema Diagram for the Code Below"><br>
<em>Data Schema Diagram for the Code Below</em></p>
<a id="technical-requirements" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Technical Requirements<a href="#technical-requirements" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Tax authorities will still demand debit/credit data in tabular form, so CRM systems aren’t going anywhere. The task of an LLM is to parse natural text—whether from a chat or voice recognition—and transform it into a function signature with a name and arguments, enabling a call to store data in a database.</p>
<p><strong>To solve this problem, several nuances must be understood:</strong></p>
<ol>
<li>As of 2025, open-source language models for offline use hallucinate in 40%-50% of cases, while the original ChatGPT does so in 5%-10%.</li>
<li>If prompts aren’t split among agents, the model will hallucinate more, as the subject of the conversation becomes vague.</li>
<li>New models that hallucinate less emerge every month. Alternative SaaS options with closed code, cheaper than ChatGPT, like DeepSeek, are also appearing.</li>
</ol>
<p><strong>As a result:</strong></p>
<ol>
<li>The chatbot code must be decoupled from the LLM provider, allowing switching between GPT4All, Ollama, OpenAI, DeepSeek, etc., without altering business logic.</li>
<li>There should be a testbed to evaluate how many prompts break when switching language models or providers, as versioning isn’t guaranteed due to silent SJW censorship changes in prompt behavior.</li>
<li>Code for orchestrating chat sessions with active agent context must be separated from the LLM provider or framework, as something new could emerge at any moment.</li>
</ol>
<a id="code-breakdown" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Code Breakdown<a href="#code-breakdown" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>For each open chat session, a Swarm orchestration with a tree of agents is required, sharing a common chat history among themselves but separate for different users. In this code, this is implemented under the hood of <a href="https://www.npmjs.com/package/agent-swarm-kit">agent-swarm-kit</a>.</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">addSwarm</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;agent-swarm-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">ROOT_SWARM</span><span class="hl-1"> = </span><span class="hl-0">addSwarm</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">swarmName:</span><span class="hl-1"> </span><span class="hl-3">&#39;root_swarm&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">agentList:</span><span class="hl-1"> [</span><br/><span class="hl-1">        </span><span class="hl-6">TRIAGE_AGENT</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-6">SALES_AGENT</span><span class="hl-1">,</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-2">defaultAgent:</span><span class="hl-1"> </span><span class="hl-6">TRIAGE_AGENT</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-1">...</span><br/><br/><span class="hl-2">app</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-3">&quot;/api/v1/session/:clientId&quot;</span><span class="hl-1">, </span><span class="hl-0">upgradeWebSocket</span><span class="hl-1">((</span><span class="hl-2">ctx</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">clientId</span><span class="hl-1"> = </span><span class="hl-2">ctx</span><span class="hl-1">.</span><span class="hl-2">req</span><span class="hl-1">.</span><span class="hl-0">param</span><span class="hl-1">(</span><span class="hl-3">&quot;clientId&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-6">complete</span><span class="hl-1">, </span><span class="hl-6">dispose</span><span class="hl-1"> } = </span><span class="hl-0">session</span><span class="hl-1">(</span><span class="hl-2">clientId</span><span class="hl-1">, </span><span class="hl-6">ROOT_SWARM</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-5">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">onMessage</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">event</span><span class="hl-1">, </span><span class="hl-2">ws</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">message</span><span class="hl-1"> = </span><span class="hl-2">event</span><span class="hl-1">.</span><span class="hl-2">data</span><span class="hl-1">.</span><span class="hl-0">toString</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-2">ws</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">complete</span><span class="hl-1">(</span><span class="hl-2">message</span><span class="hl-1">));</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">onClose</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> () </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">dispose</span><span class="hl-1">();</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}));</span>
</code><button type="button">Copy</button></pre>

<p>When creating an agent, we specify at least one <code>system message</code> describing its purpose. We also define a connector to a language model, allowing some agents to process locally for free while delegating complex tasks to a cloud service like OpenAI. If something doesn’t work, we add prompts to the system array, such as a fix for function calls in Ollama.</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">AGENT_PROMPT</span><span class="hl-1"> = </span><span class="hl-3">`You are a sales agent that handles all actions related to placing the order to purchase an item.</span><br/><span class="hl-3">Tell the users all details about products in the database by using necessary tool calls</span><br/><span class="hl-3">Do not send any JSON to the user. Format it as plain text. Do not share any internal details like ids, format text human readable</span><br/><span class="hl-3">If the previous user messages contains product request, tell him details immediately</span><br/><span class="hl-3">It is important not to call tools recursively. Execute the search once</span><br/><span class="hl-3">`</span><span class="hl-1">;</span><br/><br/><span class="hl-9">/**</span><br/><span class="hl-9"> * </span><span class="hl-4">@see</span><span class="hl-9"> </span><span class="hl-2">https://github.com/ollama/ollama/blob/86a622cbdc69e9fd501764ff7565e977fc98f00a/server/model.go#L158</span><br/><span class="hl-9"> */</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">TOOL_PROTOCOL_PROMPT</span><span class="hl-1"> = </span><span class="hl-3">`For each function call, return a json object with function name and arguments within &lt;tool_call&gt;&lt;/tool_call&gt; XML tags:</span><br/><span class="hl-3">&lt;tool_call&gt;</span><br/><span class="hl-3">{&quot;name&quot;: &lt;function-name&gt;, &quot;arguments&quot;: &lt;args-json-object&gt;}</span><br/><span class="hl-3">&lt;/tool_call&gt;</span><br/><span class="hl-3">`</span><span class="hl-1">;</span><br/><br/><span class="hl-5">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">SALES_AGENT</span><span class="hl-1"> = </span><span class="hl-0">addAgent</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">agentName:</span><span class="hl-1"> </span><span class="hl-3">&quot;sales_agent&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">completion:</span><span class="hl-1"> </span><span class="hl-6">OLLAMA_COMPLETION</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">system:</span><span class="hl-1"> [</span><span class="hl-6">TOOL_PROTOCOL_PROMPT</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-2">prompt:</span><span class="hl-1"> </span><span class="hl-6">AGENT_PROMPT</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">tools:</span><span class="hl-1"> [</span><span class="hl-6">SEARCH_PHARMA_PRODUCT</span><span class="hl-1">, </span><span class="hl-6">NAVIGATE_TO_TRIAGE</span><span class="hl-1">],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>In this example, I use Ollama to handle user requests. For those unfamiliar with the terminology: the process where a language model takes a chat history as input and generates a new message is called <em>completion</em>. The <code>agent-swarm-kit</code> uses an abstract interface that works uniformly with any cloud provider or local model. <a href="https://api-docs.deepseek.com/guides/function_calling">Use this material</a> to connect DeepSeek.</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">addCompletion</span><span class="hl-1">, </span><span class="hl-2">IModelMessage</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;agent-swarm-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">getOllama</span><span class="hl-1"> = </span><span class="hl-0">singleshot</span><span class="hl-1">(() </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">Ollama</span><span class="hl-1">({ </span><span class="hl-2">host:</span><span class="hl-1"> </span><span class="hl-6">CC_OLLAMA_HOST</span><span class="hl-1"> }));</span><br/><br/><span class="hl-5">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">OLLAMA_COMPLETION</span><span class="hl-1"> = </span><span class="hl-0">addCompletion</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">completionName:</span><span class="hl-1"> </span><span class="hl-3">&quot;ollama_completion&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">getCompletion</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-2">agentName</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">messages</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">mode</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">tools</span><span class="hl-1">,</span><br/><span class="hl-1">  }) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">response</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">getOllama</span><span class="hl-1">().</span><span class="hl-0">chat</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-2">model:</span><span class="hl-1"> </span><span class="hl-3">&quot;nemotron-mini:4b&quot;</span><span class="hl-1">, </span><span class="hl-9">// &quot;mistral-nemo:12b&quot;;</span><br/><span class="hl-1">      </span><span class="hl-2">keep_alive:</span><span class="hl-1"> </span><span class="hl-3">&quot;1h&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">messages:</span><span class="hl-1"> </span><span class="hl-2">messages</span><span class="hl-1">.</span><span class="hl-0">map</span><span class="hl-1">((</span><span class="hl-2">message</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-0">omit</span><span class="hl-1">(</span><span class="hl-2">message</span><span class="hl-1">, </span><span class="hl-3">&quot;agentName&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;mode&quot;</span><span class="hl-1">)),</span><br/><span class="hl-1">      </span><span class="hl-2">tools</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-5">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      ...</span><span class="hl-2">response</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">mode</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">agentName</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">role:</span><span class="hl-1"> </span><span class="hl-2">response</span><span class="hl-1">.</span><span class="hl-2">message</span><span class="hl-1">.</span><span class="hl-2">role</span><span class="hl-1"> </span><span class="hl-5">as</span><span class="hl-1"> </span><span class="hl-7">IModelMessage</span><span class="hl-1">[</span><span class="hl-3">&quot;role&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Changing the active agent and retrieving data from the database is done via <code>tools</code> calls: the language model returns a special XML processed by the framework for local models or by a cloud provider for OpenAI, triggering external code in Python/JS, etc. The result is logged into the chat history as <code>{&quot;role&quot;: &quot;tool&quot;, &quot;content&quot;: &quot;Found in the database: Paracetamol, a fever reducer for flu relief&quot;}</code>. From the next user message, the language model operates with the tool’s data.</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">addTool</span><span class="hl-1">, </span><span class="hl-2">changeAgent</span><span class="hl-1">, </span><span class="hl-2">execute</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;agent-swarm-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">PARAMETER_SCHEMA</span><span class="hl-1"> = </span><span class="hl-2">z</span><span class="hl-1">.</span><span class="hl-0">object</span><span class="hl-1">({}).</span><span class="hl-0">strict</span><span class="hl-1">();</span><br/><br/><span class="hl-5">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">NAVIGATE_TO_SALES</span><span class="hl-1"> = </span><span class="hl-0">addTool</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">toolName:</span><span class="hl-1"> </span><span class="hl-3">&quot;navigate_to_sales_tool&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">validate</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">clientId</span><span class="hl-1">, </span><span class="hl-2">agentName</span><span class="hl-1">, </span><span class="hl-2">params</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-6">success</span><span class="hl-1"> } = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">PARAMETER_SCHEMA</span><span class="hl-1">.</span><span class="hl-0">spa</span><span class="hl-1">(</span><span class="hl-2">params</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-2">success</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">call</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">clientId</span><span class="hl-1">, </span><span class="hl-2">agentName</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">commitToolOutput</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-3">&quot;Navigation success&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">clientId</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">agentName</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">changeAgent</span><span class="hl-1">(</span><span class="hl-6">SALES_AGENT</span><span class="hl-1">, </span><span class="hl-2">clientId</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><span class="hl-3">&quot;Say hello to the user&quot;</span><span class="hl-1">, </span><span class="hl-2">clientId</span><span class="hl-1">, </span><span class="hl-6">SALES_AGENT</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;function&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">function:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">name:</span><span class="hl-1"> </span><span class="hl-3">&quot;navigate_to_sales_tool&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">description:</span><span class="hl-1"> </span><span class="hl-3">&quot;Navigate to sales agent&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">parameters:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;object&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">properties:</span><span class="hl-1"> {},</span><br/><span class="hl-1">      </span><span class="hl-2">required:</span><span class="hl-1"> [],</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>To avoid hardcoding initial agent messages, switching agents triggers a simulated user request to say hello.</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">addTool</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">commitSystemMessage</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">commitToolOutput</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">execute</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">getLastUserMessage</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;agent-swarm-kit&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">PARAMETER_SCHEMA</span><span class="hl-1"> = </span><span class="hl-2">z</span><br/><span class="hl-1">  .</span><span class="hl-0">object</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">description:</span><span class="hl-1"> </span><span class="hl-2">z</span><br/><span class="hl-1">      .</span><span class="hl-0">string</span><span class="hl-1">()</span><br/><span class="hl-1">      .</span><span class="hl-0">min</span><span class="hl-1">(</span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-3">&quot;Fulltext is required&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-0">strict</span><span class="hl-1">();</span><br/><br/><span class="hl-5">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">SEARCH_PHARMA_PRODUCT</span><span class="hl-1"> = </span><span class="hl-0">addTool</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">toolName:</span><span class="hl-1"> </span><span class="hl-3">&quot;search_pharma_product&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">validate</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">clientId</span><span class="hl-1">, </span><span class="hl-2">agentName</span><span class="hl-1">, </span><span class="hl-2">params</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-6">success</span><span class="hl-1"> } = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-6">PARAMETER_SCHEMA</span><span class="hl-1">.</span><span class="hl-0">spa</span><span class="hl-1">(</span><span class="hl-2">params</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-2">success</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">call</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">clientId</span><span class="hl-1">, </span><span class="hl-2">agentName</span><span class="hl-1">, </span><span class="hl-2">params</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-2">search</span><span class="hl-1"> = </span><span class="hl-3">&quot;&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-2">params</span><span class="hl-1">.</span><span class="hl-2">description</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-2">search</span><span class="hl-1"> = </span><span class="hl-0">String</span><span class="hl-1">(</span><span class="hl-2">params</span><span class="hl-1">.</span><span class="hl-2">description</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">search</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">getLastUserMessage</span><span class="hl-1">(</span><span class="hl-2">clientId</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (!</span><span class="hl-2">search</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">commitToolOutput</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-2">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><span class="hl-3">`The products does not found in the database`</span><span class="hl-1">),</span><br/><span class="hl-1">        </span><span class="hl-2">clientId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">agentName</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">      </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-3">&quot;Tell user to specify search criteria for the pharma product&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">clientId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">agentName</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">products</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-2">ioc</span><span class="hl-1">.</span><span class="hl-2">productDbPublicService</span><span class="hl-1">.</span><span class="hl-0">findByFulltext</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">search</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">clientId</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-2">products</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">commitToolOutput</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-2">str</span><span class="hl-1">.</span><span class="hl-0">newline</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-3">`The next pharma product found in database: </span><span class="hl-4">${</span><span class="hl-2">products</span><span class="hl-10">.</span><span class="hl-0">map</span><span class="hl-10">(</span><br/><span class="hl-10">            </span><span class="hl-2">serializeProduct</span><br/><span class="hl-10">          )</span><span class="hl-4">}</span><span class="hl-3">`</span><br/><span class="hl-1">        ),</span><br/><span class="hl-1">        </span><span class="hl-2">clientId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">agentName</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">      </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">commitSystemMessage</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-3">&quot;Do not call the search_pharma_product next time!&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">clientId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">agentName</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">      </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><br/><span class="hl-1">        </span><span class="hl-3">&quot;Tell user the products found in the database.&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">clientId</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-2">agentName</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">commitToolOutput</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-3">`The products does not found in the database`</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">clientId</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">agentName</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">    </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-3">&quot;Tell user to specify search criteria for the pharma product&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">clientId</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">agentName</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;function&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">function:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">name:</span><span class="hl-1"> </span><span class="hl-3">&quot;search_pharma_product&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">description:</span><br/><span class="hl-1">      </span><span class="hl-3">&quot;Retrieve several pharma products from the database based on description&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">parameters:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;object&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">properties:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">description:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;string&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-2">description:</span><br/><span class="hl-1">            </span><span class="hl-3">&quot;REQUIRED! Minimum one word. The product description. Must include several sentences with description and keywords to find a product&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-2">required:</span><span class="hl-1"> [</span><span class="hl-3">&quot;description&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Language models can generate a dictionary of named parameters for <code>tools</code> calls. However, open-source models struggle with closed-loop technical requirements, making it simpler to analyze the conversation itself.</p>
<a id="how-the-agent-swarm-works" class="tsd-anchor"></a><h3 class="tsd-anchor-link">How the Agent Swarm Works<a href="#how-the-agent-swarm-works" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li>Multiple ChatGPT sessions (agents) execute tool calls. Each agent can use different models, e.g., <code>mistral 7b</code> for casual chats, <code>nemotron</code> for business talks.</li>
<li>The agent swarm directs messages to the active ChatGPT session (agent) for each <code>WebSocket</code> channel, using the URL parameter <code>clientId</code>. A new channel with its own agent swarm is created for each new human chat.</li>
<li>The active ChatGPT session (agent) in the swarm can be changed by executing a tool.</li>
<li>All client sessions share a common chat message history for all agents. Each client’s chat history retains the last 25 messages with rotation. Only <code>assistant</code> and <code>user</code> type messages are passed between ChatGPT sessions (agents), while <code>system</code> and <code>tool</code> messages are scoped to the agent, so each agent only knows its relevant tools. As a result, each ChatGPT session (agent) has its unique system prompt.</li>
<li>If an agent’s output fails validation (non-existent tool call, incorrect arguments, empty output, XML tags or JSON in output), a rescue algorithm attempts to fix the model. It first hides prior messages from the model; if that fails, it returns a fallback like “Sorry, I didn’t understand. Could you repeat that?”</li>
</ol>
<a id="useful-functions-for-administering-the-agent-swarm" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Useful Functions for Administering the Agent Swarm<a href="#useful-functions-for-administering-the-agent-swarm" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><code>addAgent</code> - Register a new agent.</li>
<li><code>addCompletion</code> - Register a new language model: cloud, local, or mock.</li>
<li><code>addSwarm</code> - Register a group of agents to handle user chats.</li>
<li><code>addTool</code> - Register a tool to integrate language models with external systems.</li>
<li><code>changeAgent</code> - Change the active agent in the swarm.</li>
<li><code>complete</code> - Request a response to a message passed to the agent swarm.</li>
<li><code>session</code> - Create a chat session, providing callbacks for session completion and sending new messages.</li>
<li><code>getRawHistory</code> - Retrieve raw system history for debugging.</li>
<li><code>getAgentHistory</code> - Retrieve the history an agent sees, adjusted for self-recovery and message recipients.</li>
<li><code>commitToolOutput</code> - Log the result of a function execution into the history. If a function is called, the agent freezes until a response is received.</li>
<li><code>commitSystemMessage</code> - Append new instructions to the system prompt.</li>
<li><code>commitFlush</code> - Clear an agent’s conversation if incorrect responses are received or the model recursively calls a tool in error.</li>
<li><code>execute</code> - Prompt the neural network to take initiative and message the user first.</li>
<li><code>emit</code> - Send a pre-prepared message to the user.</li>
<li><code>getLastUserMessage</code> - Retrieve the last user message (excluding <code>execute</code>).</li>
<li><code>commitUserMessage</code> - Save a user message to the chat history without a response, e.g., if the user spams messages before processing completes.</li>
<li><code>getAgentName</code> - Get the name of the active agent.</li>
<li><code>getUserHistory</code> - Retrieve the history of user messages.</li>
<li><code>getAssistantHistory</code> - Retrieve the history of language model messages.</li>
<li><code>getLastAssistantMessage</code> - Retrieve the last message from the language model.</li>
<li><code>getLastSystemMessage</code> - Retrieve the last system prompt addition.</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#where-the-market-is-heading"><span>Where the <wbr/>Market is <wbr/>Heading</span></a><a href="#llm-as-a-new-type-of-user-interface"><span>LLM as a <wbr/>New <wbr/>Type of <wbr/>User <wbr/>Interface</span></a><a href="#technical-requirements"><span>Technical <wbr/>Requirements</span></a><a href="#code-breakdown"><span>Code <wbr/>Breakdown</span></a><ul><li><a href="#how-the-agent-swarm-works"><span>How the <wbr/>Agent <wbr/>Swarm <wbr/>Works</span></a></li></ul><a href="#useful-functions-for-administering-the-agent-swarm"><span>Useful <wbr/>Functions for <wbr/>Administering the <wbr/>Agent <wbr/>Swarm</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">agent-swarm-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(100273846, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        ecommerce:"dataLayer"
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/100273846" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-85RYYZDT35"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-85RYYZDT35');
</script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(100273846, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        ecommerce:"dataLayer"
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/100273846" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-85RYYZDT35"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-85RYYZDT35');
</script>
