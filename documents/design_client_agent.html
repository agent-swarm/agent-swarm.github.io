<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/client_agent | agent-swarm-kit</title><meta name="description" content="Documentation for agent-swarm-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">agent-swarm-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">agent-swarm-kit</a></li><li><a href="design_client_agent.html">design/client_agent</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="client-agent" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Client Agent<a href="#client-agent" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>The Client Agent is the fundamental building block in the agent-swarm-kit library, providing the core implementation of the agent interface. It handles message execution, tool calls, model completions, history management, and output emission. This document covers the implementation details, architecture, and functionality of the ClientAgent class. For information about coordinating multiple agents, see <a href="#2.2">Swarm Management</a>.</p>
<a id="core-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Core Architecture<a href="#core-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The ClientAgent class implements the IAgent interface, providing the essential functionality for agent interactions within the swarm system. It serves as a bridge between user inputs, language models, and tools, managing the flow of messages and tool executions.</p>
<p><img src="../media/3_Client_Agent_0.svg" alt="Mermaid Diagram"></p>
<a id="agent-initialization-and-parameters" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Agent Initialization and Parameters<a href="#agent-initialization-and-parameters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When initializing a ClientAgent, it requires an instance of IAgentParams which configures its behavior, including:</p>
<ul>
<li><strong>clientId</strong>: Unique identifier for the client</li>
<li><strong>agentName</strong>: Name of the agent</li>
<li><strong>history</strong>: History instance for message tracking</li>
<li><strong>completion</strong>: Completion model for generating responses</li>
<li><strong>logger</strong>: Logger for recording activity</li>
<li><strong>bus</strong>: Event bus for inter-component communication</li>
<li><strong>mcp</strong>: Model Context Protocol for external tool integration</li>
<li><strong>tools</strong>: Optional array of tools available to the agent</li>
<li><strong>transform</strong>: Function to transform model outputs</li>
<li><strong>validate</strong>: Function to validate outputs before returning them</li>
</ul>
<p><img src="../media/3_Client_Agent_1.svg" alt="Mermaid Diagram"></p>
<a id="execution-flow" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Execution Flow<a href="#execution-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The execution flow in ClientAgent is its core functionality. The execute method processes input, gets model completions, executes tools if needed, and emits output.</p>
<p><img src="../media/3_Client_Agent_2.svg" alt="Mermaid Diagram"></p>
<a id="tool-handling" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Tool Handling<a href="#tool-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ClientAgent's ability to execute tools is a key feature. It extracts tool calls from model completions, validates them, executes them, and handles their results.</p>
<a id="tool-execution-process" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tool Execution Process<a href="#tool-execution-process" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li>Tool calls are extracted from the model completion</li>
<li>Each tool is validated before execution</li>
<li>Tools are executed asynchronously</li>
<li>Tool outputs are committed to history</li>
<li>Errors are handled with resurrection strategies</li>
</ol>
<a id="tool-abort-controller" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tool Abort Controller<a href="#tool-abort-controller" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The ClientAgent includes a ToolAbortController class for managing tool execution cancellation:</p>
<p><img src="../media/3_Client_Agent_3.svg" alt="Mermaid Diagram"></p>
<a id="error-handling-and-recovery" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Error Handling and Recovery<a href="#error-handling-and-recovery" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ClientAgent includes robust error handling, particularly for tool execution failures. It uses various strategies to recover from errors:</p>
<ol>
<li><strong>Flush Strategy</strong>: Clears history and begins a new conversation</li>
<li><strong>Recomplete Strategy</strong>: Asks the model to fix the error</li>
<li><strong>Custom Strategy</strong>: Uses a custom function to handle errors</li>
</ol>
<p><img src="../media/3_Client_Agent_4.svg" alt="Mermaid Diagram"></p>
<a id="model-context-protocol-integration" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Model Context Protocol Integration<a href="#model-context-protocol-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ClientAgent integrates with the Model Context Protocol (MCP) system, allowing agents to interact with external tools in various programming languages. MCP tools are mapped to agent tools via the <code>mapMcpToolCall</code> function.</p>
<p><img src="../media/3_Client_Agent_5.svg" alt="Mermaid Diagram"></p>
<a id="stateless-execution" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Stateless Execution<a href="#stateless-execution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>run</code> method provides stateless execution, which is useful for one-off computations without affecting history or triggering tool executions.</p>
<p><img src="../media/3_Client_Agent_6.svg" alt="Mermaid Diagram"></p>
<a id="integration-with-other-components" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration With Other Components<a href="#integration-with-other-components" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ClientAgent integrates with several other components in the agent-swarm-kit architecture:</p>
<p><img src="../media/3_Client_Agent_7.svg" alt="Mermaid Diagram"></p>
<a id="lifecycle-management" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Lifecycle Management<a href="#lifecycle-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ClientAgent manages its lifecycle through various methods:</p>
<ol>
<li><strong>Initialization</strong>: Configures with IAgentParams, initializes subjects</li>
<li><strong>Execution</strong>: Processes inputs, generates completions, executes tools</li>
<li><strong>Commit Methods</strong>: Updates history with messages of different types</li>
<li><strong>Disposal</strong>: Releases resources and performs cleanup</li>
</ol>
<a id="usage-in-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Usage in Services<a href="#usage-in-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The ClientAgent is created and managed by the AgentConnectionService, which is exposed via the AgentPublicService. These services provide a clean API for working with agents:</p>
<p><img src="../media/3_Client_Agent_8.svg" alt="Mermaid Diagram"></p>
<a id="event-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Event System<a href="#event-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>ClientAgent uses a Subject-based event system for handling asynchronous operations and communication:</p>
<ul>
<li><strong>_outputSubject</strong>: Emits outputs after execution</li>
<li><strong>_toolCommitSubject</strong>: Signals tool output commitment</li>
<li><strong>_agentChangeSubject</strong>: Signals agent changes</li>
<li><strong>_toolErrorSubject</strong>: Signals tool execution errors</li>
<li><strong>_toolStopSubject</strong>: Signals tool execution stopping</li>
<li><strong>_resqueSubject</strong>: Signals model resurrection</li>
</ul>
<p><img src="../media/3_Client_Agent_9.svg" alt="Mermaid Diagram"></p>
<a id="conclusion" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Conclusion<a href="#conclusion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The ClientAgent is the core component that handles individual agent functionality in the agent-swarm-kit. It manages:</p>
<ol>
<li>Execution of inputs with tool support</li>
<li>Message history through commit methods</li>
<li>Completions from language models</li>
<li>Tool calls and their results</li>
<li>Error recovery and resurrection</li>
<li>Event-based communication</li>
</ol>
<p>It provides a robust foundation for building complex agent-based systems, with clean interfaces and powerful capabilities.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#client-agent"><span>Client <wbr/>Agent</span></a><ul><li><a href="#core-architecture"><span>Core <wbr/>Architecture</span></a></li><li><a href="#agent-initialization-and-parameters"><span>Agent <wbr/>Initialization and <wbr/>Parameters</span></a></li><li><a href="#execution-flow"><span>Execution <wbr/>Flow</span></a></li><li><a href="#tool-handling"><span>Tool <wbr/>Handling</span></a></li><li><ul><li><a href="#tool-execution-process"><span>Tool <wbr/>Execution <wbr/>Process</span></a></li><li><a href="#tool-abort-controller"><span>Tool <wbr/>Abort <wbr/>Controller</span></a></li></ul></li><li><a href="#error-handling-and-recovery"><span>Error <wbr/>Handling and <wbr/>Recovery</span></a></li><li><a href="#model-context-protocol-integration"><span>Model <wbr/>Context <wbr/>Protocol <wbr/>Integration</span></a></li><li><a href="#stateless-execution"><span>Stateless <wbr/>Execution</span></a></li><li><a href="#integration-with-other-components"><span>Integration <wbr/>With <wbr/>Other <wbr/>Components</span></a></li><li><a href="#lifecycle-management"><span>Lifecycle <wbr/>Management</span></a></li><li><a href="#usage-in-services"><span>Usage in <wbr/>Services</span></a></li><li><a href="#event-system"><span>Event <wbr/>System</span></a></li><li><a href="#conclusion"><span>Conclusion</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">agent-swarm-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(100273846, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        ecommerce:"dataLayer"
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/100273846" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-85RYYZDT35"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-85RYYZDT35');
</script>
