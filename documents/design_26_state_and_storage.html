<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/26_state_and_storage | agent-swarm-kit</title><meta name="description" content="Documentation for agent-swarm-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">agent-swarm-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">agent-swarm-kit</a></li><li><a href="design_26_state_and_storage.html">design/26_state_and_storage</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="managing-state-and-storage" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Managing State and Storage<a href="#managing-state-and-storage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document covers the data management systems in agent-swarm-kit, including storage with embedding-based search capabilities, client and shared state management, session memory handling, and data persistence patterns. It provides guidance on configuring these systems and best practices for managing data across multi-agent applications.</p>
<p>For information about building multi-agent workflows that use these storage and state systems, see <a href="design_05_session_management.html">Building Multi-Agent Systems</a>. For details on tool integration that may store or retrieve data, see <a href="design_05_session_management.html">Tool Integration</a>.</p>
<a id="storage-system-architecture" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Storage System Architecture<a href="#storage-system-architecture" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides two primary storage systems: client-specific storage and shared storage, both with embedding-based search capabilities.</p>
<p><img src="../media/26_Managing_State_and_Storage_0.svg" alt="Mermaid Diagram"></p>
<p><strong>Client Storage Operations</strong></p>
<p>The <code>StorageUtils</code> class provides client-scoped storage operations with embedding search:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>Validation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>take()</code></td>
<td>Search and retrieve items</td>
<td>Client session, agent-storage registration</td>
</tr>
<tr>
<td><code>upsert()</code></td>
<td>Insert or update items</td>
<td>Client session, agent-storage registration</td>
</tr>
<tr>
<td><code>remove()</code></td>
<td>Delete items by ID</td>
<td>Client session, agent-storage registration</td>
</tr>
<tr>
<td><code>get()</code></td>
<td>Retrieve item by ID</td>
<td>Agent-storage registration</td>
</tr>
<tr>
<td><code>list()</code></td>
<td>List all items with optional filter</td>
<td>Agent-storage registration</td>
</tr>
<tr>
<td><code>createNumericIndex()</code></td>
<td>Generate sequential index</td>
<td>Agent-storage registration</td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>Remove all items</td>
<td>Client session, agent-storage registration</td>
</tr>
</tbody>
</table>
<p><strong>Shared Storage Operations</strong></p>
<p>The <code>SharedStorageUtils</code> class provides system-wide storage without client scoping:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Purpose</th>
<th>Validation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>take()</code></td>
<td>Search and retrieve items</td>
<td>Storage name validation</td>
</tr>
<tr>
<td><code>upsert()</code></td>
<td>Insert or update items</td>
<td>Storage name validation</td>
</tr>
<tr>
<td><code>remove()</code></td>
<td>Delete items by ID</td>
<td>Storage name validation</td>
</tr>
<tr>
<td><code>get()</code></td>
<td>Retrieve item by ID</td>
<td>Storage name validation</td>
</tr>
<tr>
<td><code>list()</code></td>
<td>List all items with optional filter</td>
<td>Storage name validation</td>
</tr>
<tr>
<td><code>clear()</code></td>
<td>Remove all items</td>
<td>Storage name validation</td>
</tr>
</tbody>
</table>
<a id="state-management-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">State Management System<a href="#state-management-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework provides both client-specific and shared state management with functional update patterns.</p>
<p><img src="../media/26_Managing_State_and_Storage_1.svg" alt="Mermaid Diagram"></p>
<p><strong>Client State Management</strong></p>
<p>The <code>StateUtils</code> class manages client-scoped state with these operations:</p>
<ul>
<li><code>getState()</code> - Retrieves current state value for a client and state name</li>
<li><code>setState()</code> - Updates state using either direct value or dispatch function</li>
<li><code>clearState()</code> - Resets state to initial value</li>
</ul>
<p><strong>Shared State Management</strong></p>
<p>The <code>SharedStateUtils</code> class manages system-wide state:</p>
<ul>
<li><code>getState()</code> - Retrieves current shared state value</li>
<li><code>setState()</code> - Updates shared state using direct value or dispatch function</li>
<li><code>clearState()</code> - Resets shared state to initial value</li>
</ul>
<p>Both state systems support functional updates where you can pass a function that receives the previous state and returns the new state:</p>
<a id="session-memory-management" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Session Memory Management<a href="#session-memory-management" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Session memory provides temporary, non-persistent storage scoped to individual client sessions.</p>
<p><img src="../media/26_Managing_State_and_Storage_2.svg" alt="Mermaid Diagram"></p>
<p><strong>Session Memory Operations</strong></p>
<p>The <code>SchemaUtils</code> class provides session memory management:</p>
<ul>
<li><code>writeSessionMemory()</code> - Stores data for a client session with optional persistence</li>
<li><code>readSessionMemory()</code> - Retrieves data for a client session, loading from persistence if configured</li>
<li>Session validation ensures operations only occur on valid active sessions</li>
</ul>
<p>The <code>MemorySchemaService</code> provides the underlying memory operations:</p>
<ul>
<li><code>hasValue()</code> - Checks if session has memory data</li>
<li><code>writeValue()</code> - Merges new data with existing session memory</li>
<li><code>readValue()</code> - Retrieves session memory data</li>
<li><code>dispose()</code> - Cleans up session memory on termination</li>
</ul>
<p><strong>Memory Persistence Configuration</strong></p>
<p>Memory persistence is controlled by the <code>CC_PERSIST_MEMORY_STORAGE</code> configuration flag. When enabled, session memory is automatically saved to and loaded from JSON files.</p>
<a id="data-persistence-and-file-storage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Data Persistence and File Storage<a href="#data-persistence-and-file-storage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>All persistent data in the framework is stored as JSON files in the file system, managed through the persistence layer.</p>
<p><img src="../media/26_Managing_State_and_Storage_3.svg" alt="Mermaid Diagram"></p>
<p><strong>Persistence Configuration</strong></p>
<p>Key configuration options control persistence behavior:</p>
<ul>
<li><code>CC_PERSIST_ENABLED_BY_DEFAULT</code> - Controls whether persistence is enabled by default</li>
<li><code>CC_PERSIST_MEMORY_STORAGE</code> - Enables session memory persistence</li>
<li>File storage location defaults to <code>./logs/data/</code> directory</li>
</ul>
<p><strong>Queued Persistence Operations</strong></p>
<p>The framework uses queued operations to prevent race conditions during concurrent writes. The <code>SchemaUtils</code> class demonstrates this pattern with its private queued write function for memory persistence.</p>
<a id="configuration-and-best-practices" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Configuration and Best Practices<a href="#configuration-and-best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="storage-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Storage Configuration<a href="#storage-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Agent Storage Registration</strong>
Storage must be registered with agents before use. The validation system ensures agents can only access their registered storage:</p>
<pre><code class="typescript"><span class="hl-9">// Storage validation occurs in all storage operations</span><br/><span class="hl-5">if</span><span class="hl-1"> (!</span><span class="hl-2">swarm</span><span class="hl-1">.</span><span class="hl-2">agentValidationService</span><span class="hl-1">.</span><span class="hl-0">hasStorage</span><span class="hl-1">(</span><span class="hl-2">agentName</span><span class="hl-1">, </span><span class="hl-2">storageName</span><span class="hl-1">)) {</span><br/><span class="hl-1">  </span><span class="hl-5">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-3">`agent-swarm StorageUtils </span><span class="hl-4">${</span><span class="hl-2">storageName</span><span class="hl-4">}</span><span class="hl-3"> not registered in </span><span class="hl-4">${</span><span class="hl-2">agentName</span><span class="hl-4">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p><strong>Embedding Search Configuration</strong>
Storage operations support optional relevance scoring for embedding-based search:</p>
<ul>
<li><code>take()</code> method accepts optional <code>score</code> parameter for filtering results</li>
<li>Search queries use embedding similarity to find relevant items</li>
<li>Total parameter limits the number of results returned</li>
</ul>
<a id="state-management-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">State Management Patterns<a href="#state-management-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Functional State Updates</strong>
Use dispatch functions for complex state updates:</p>
<pre><code class="typescript"><span class="hl-9">// Direct value update</span><br/><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-2">State</span><span class="hl-1">.</span><span class="hl-0">setState</span><span class="hl-1">(</span><span class="hl-2">newValue</span><span class="hl-1">, { </span><span class="hl-2">clientId</span><span class="hl-1">, </span><span class="hl-2">agentName</span><span class="hl-1">, </span><span class="hl-2">stateName</span><span class="hl-1"> });</span><br/><br/><span class="hl-9">// Functional update</span><br/><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-2">State</span><span class="hl-1">.</span><span class="hl-0">setState</span><span class="hl-1">(</span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">prevState</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">return</span><span class="hl-1"> { ...</span><span class="hl-2">prevState</span><span class="hl-1">, </span><span class="hl-2">newProperty:</span><span class="hl-1"> </span><span class="hl-2">computedValue</span><span class="hl-1"> };</span><br/><span class="hl-1">}, { </span><span class="hl-2">clientId</span><span class="hl-1">, </span><span class="hl-2">agentName</span><span class="hl-1">, </span><span class="hl-2">stateName</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<p><strong>State Scoping</strong>
Choose between client-specific and shared state based on data scope:</p>
<ul>
<li>Use <code>StateUtils</code> for client-specific data that should be isolated per session</li>
<li>Use <code>SharedStateUtils</code> for system-wide data shared across all clients</li>
</ul>
<a id="session-memory-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Session Memory Patterns<a href="#session-memory-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Temporary Data Storage</strong>
Use session memory for temporary data that doesn't need persistence:</p>
<pre><code class="typescript"><span class="hl-9">// Store temporary session data</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">sessionData</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-2">Schema</span><span class="hl-1">.</span><span class="hl-0">writeSessionMemory</span><span class="hl-1">(</span><span class="hl-2">clientId</span><span class="hl-1">, { </span><span class="hl-2">tempValue:</span><span class="hl-1"> </span><span class="hl-2">data</span><span class="hl-1"> });</span><br/><br/><span class="hl-9">// Retrieve session data</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">sessionData</span><span class="hl-1"> = </span><span class="hl-5">await</span><span class="hl-1"> </span><span class="hl-2">Schema</span><span class="hl-1">.</span><span class="hl-0">readSessionMemory</span><span class="hl-1">(</span><span class="hl-2">clientId</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>Data Serialization</strong>
The <code>serialize()</code> method helps format data for display or logging:</p>
<pre><code class="typescript"><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">formattedData</span><span class="hl-1"> = </span><span class="hl-2">Schema</span><span class="hl-1">.</span><span class="hl-0">serialize</span><span class="hl-1">(</span><span class="hl-2">data</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">mapKey</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">key</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">key</span><span class="hl-1">.</span><span class="hl-0">toUpperCase</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-0">mapValue</span><span class="hl-2">:</span><span class="hl-1"> (</span><span class="hl-2">key</span><span class="hl-1">, </span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-2">value</span><span class="hl-1">.</span><span class="hl-0">slice</span><span class="hl-1">(</span><span class="hl-8">0</span><span class="hl-1">, </span><span class="hl-8">100</span><span class="hl-1">)</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="performance-considerations" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Performance Considerations<a href="#performance-considerations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p><strong>Concurrent Operations</strong>
The framework handles concurrent operations through:</p>
<ul>
<li>Queued persistence operations to prevent race conditions</li>
<li>Session validation to ensure operations on active sessions only</li>
<li>Context scoping for proper operation isolation</li>
</ul>
<p><strong>Memory Management</strong></p>
<ul>
<li>Session memory is automatically cleaned up when sessions are disposed</li>
<li>Use <code>dispose()</code> methods to explicitly clean up resources</li>
<li>Persistence can be disabled for performance-critical applications</li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#managing-state-and-storage"><span>Managing <wbr/>State and <wbr/>Storage</span></a><ul><li><a href="#storage-system-architecture"><span>Storage <wbr/>System <wbr/>Architecture</span></a></li><li><a href="#state-management-system"><span>State <wbr/>Management <wbr/>System</span></a></li><li><a href="#session-memory-management"><span>Session <wbr/>Memory <wbr/>Management</span></a></li><li><a href="#data-persistence-and-file-storage"><span>Data <wbr/>Persistence and <wbr/>File <wbr/>Storage</span></a></li><li><a href="#configuration-and-best-practices"><span>Configuration and <wbr/>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#storage-configuration"><span>Storage <wbr/>Configuration</span></a></li><li><a href="#state-management-patterns"><span>State <wbr/>Management <wbr/>Patterns</span></a></li><li><a href="#session-memory-patterns"><span>Session <wbr/>Memory <wbr/>Patterns</span></a></li><li><a href="#performance-considerations"><span>Performance <wbr/>Considerations</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">agent-swarm-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(100273846, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        ecommerce:"dataLayer"
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/100273846" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-85RYYZDT35"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-85RYYZDT35');
</script>
