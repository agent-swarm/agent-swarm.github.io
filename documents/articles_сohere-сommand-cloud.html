<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>articles/сohere-сommand-cloud | agent-swarm-kit</title><meta name="description" content="Documentation for agent-swarm-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">agent-swarm-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">agent-swarm-kit</a></li><li><a href="articles_сohere-сommand-cloud.html">articles/сohere-сommand-cloud</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="cohere-command--the-revolution-we-missed" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Cohere Command — The Revolution We Missed<a href="#cohere-command--the-revolution-we-missed" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>For a long time, I was searching for a model specifically designed for invoking tools for external integrations. The key criterion was minimizing hallucinations when using consumer-grade hardware.</p>
<p><img src="../media/27a6588000b861ec4a3c713f4e911165.png" alt="Image"><br>
<em>Caption: <a href="https://huggingface.co/tripolskypetr/command_r_gguf">https://huggingface.co/tripolskypetr/command_r_gguf</a></em></p>
<p>If a language model with tens of billions of parameters requires purchasing a specialized $5,000 graphics card—assuming you can even get it delivered and installed into a compatible motherboard—such a business model isn’t scalable.</p>
<p>The task was clear: maximize the use of existing hardware. Historically, our office has been equipped with systems featuring 32GB of RAM and RTX 3060 GPUs with 12GB of VRAM.</p>
<a id="search-results" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Search Results<a href="#search-results" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>In the Ollama model library, I found the <a href="https://ollama.com/oybekdevuz/command-r">command-r</a> model. Initially, <a href="https://github.com/ollama/ollama/issues/9680#issuecomment-2742827704">its tools were broken</a>, but after some complaints in the issues section, I managed to cobble together a fix with some copy-pasted code.</p>
<p><img src="../media/db9953ba6398d2e20d7b9b361bc1a1ab.png" alt="Image"><br>
<em>Caption: ollama run oybekdevuz/command-r</em></p>
<p>The model launched, consuming 90% of the system resources described above. Tool invocation worked smoothly—no lag or hallucinations—entirely powered by the GPU. This was the best-case scenario, as it fully utilized our minimal hardware.</p>
<p><img src="../media/00736133279d5105229dfcc7bcee0111.png" alt="Image"><br>
<em>Caption: Tool invocation working</em></p>
<p>We tested the tool invocation. Compared to OpenAI, there’s a difference: since the model is optimized for external API calls, every user action must be defined as a separate tool. This has its advantages—chat behavior becomes predictable. If the model says an item was added to the cart, it means an actual HTTP request was sent to the server, not just placeholder text.</p>
<a id="what-exactly-did-we-miss" class="tsd-anchor"></a><h3 class="tsd-anchor-link">What Exactly Did We Miss?<a href="#what-exactly-did-we-miss" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Cohere, the LLM provider, offers not only cloud services but also open-source model files. It’s akin to getting a GGUF version of GPT-4o and running it locally. In the end, we overlooked their cloud offering entirely.</p>
<p><img src="../media/0d2d7aca56a5c73392adf3a2eed420a1.png" alt="Image"><br>
<em>Caption: <a href="https://docs.cohere.com/docs/rate-limits">https://docs.cohere.com/docs/rate-limits</a></em></p>
<p>Cohere provides a free tier with 20 requests per minute per API key. I couldn’t find any limit on how long a trial token remains active.</p>
<p><img src="../media/4ba84de774c07880b143fecb22adfe43.png" alt="Image"><br>
<em>Caption: <a href="https://dashboard.cohere.com/api-keys">https://dashboard.cohere.com/api-keys</a></em></p>
<p>The pricing is radically more affordable than OpenAI’s. But that’s not what I wanted to write about: <strong>What if we created a carousel of trial tokens?</strong></p>
<p><img src="../media/6938d459f317a071753884e372fb66d6.png" alt="Image"><br>
<em>Caption: <a href="https://cohere.com/pricing">https://cohere.com/pricing</a></em></p>
<a id="the-fun-carousel" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Fun Carousel<a href="#the-fun-carousel" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Our agent swarm engine uses an adapter to connect to cloud LLMs, allowing us to switch from Yandex Cloud or any other provider if subscription costs spike.</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">Adapter</span><span class="hl-1">, </span><span class="hl-2">addCompletion</span><span class="hl-1">, </span><span class="hl-2">RoundRobin</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;agent-swarm-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">CompletionName</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;../enum/CompletionName&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">CohereClientV2</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;cohere-ai&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-0">getCohere</span><span class="hl-1"> = (</span><span class="hl-2">token</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">CohereClientV2</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">token</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">COHERE_TOKENS</span><span class="hl-1"> = [</span><span class="hl-2">process</span><span class="hl-1">.</span><span class="hl-2">env</span><span class="hl-1">.</span><span class="hl-6">COHERE_API_KEY</span><span class="hl-1">, </span><span class="hl-9">/* You know what to do :-) */</span><span class="hl-1">];</span><br/><br/><span class="hl-0">addCompletion</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">completionName:</span><span class="hl-1"> </span><span class="hl-2">CompletionName</span><span class="hl-1">.</span><span class="hl-2">CohereCompletion</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">getCompletion:</span><span class="hl-1"> </span><span class="hl-2">RoundRobin</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">(</span><span class="hl-6">COHERE_TOKENS</span><span class="hl-1">, (</span><span class="hl-2">apiKey</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><br/><span class="hl-1">    </span><span class="hl-2">Adapter</span><span class="hl-1">.</span><span class="hl-0">fromCohereClientV2</span><span class="hl-1">(</span><span class="hl-0">getCohere</span><span class="hl-1">(</span><span class="hl-2">apiKey</span><span class="hl-1">), </span><span class="hl-3">&quot;command-r-08-2024&quot;</span><span class="hl-1">)</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>In addition to running command-r in the cloud, we added a connector for Ollama to the academic project.</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">Adapter</span><span class="hl-1">, </span><span class="hl-2">addCompletion</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;agent-swarm-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">CompletionName</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;../enum/CompletionName&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">singleshot</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;functools-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">Ollama</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;ollama&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">getOllama</span><span class="hl-1"> = </span><span class="hl-0">singleshot</span><span class="hl-1">(</span><br/><span class="hl-1">  () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">Ollama</span><span class="hl-1">({ </span><span class="hl-2">host:</span><span class="hl-1"> </span><span class="hl-3">&quot;http://127.0.0.1:11434&quot;</span><span class="hl-1"> })</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-0">addCompletion</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">completionName:</span><span class="hl-1"> </span><span class="hl-2">CompletionName</span><span class="hl-1">.</span><span class="hl-2">OllamaCompletion</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">getCompletion:</span><span class="hl-1"> </span><span class="hl-2">Adapter</span><span class="hl-1">.</span><span class="hl-0">fromOllama</span><span class="hl-1">(</span><span class="hl-0">getOllama</span><span class="hl-1">(), </span><span class="hl-3">&quot;oybekdevuz/command-r&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>And a connector for LMStudio. Additionally, the GGUF model image was uploaded to <a href="https://huggingface.co/tripolskypetr/command_r_gguf">HuggingFace at this link</a> for those who prefer launching models with a GUI rather than the console.</p>
<pre><code class="typescript"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">Adapter</span><span class="hl-1">, </span><span class="hl-2">addCompletion</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;agent-swarm-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">singleshot</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;functools-kit&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-2">OpenAI</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;openai&quot;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-2">CompletionName</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-3">&quot;../enum/CompletionName&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">getOpenAI</span><span class="hl-1"> = </span><span class="hl-0">singleshot</span><span class="hl-1">(</span><br/><span class="hl-1">  () </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-0">OpenAI</span><span class="hl-1">({ </span><span class="hl-2">baseURL:</span><span class="hl-1"> </span><span class="hl-3">&quot;http://127.0.0.1:1234/v1&quot;</span><span class="hl-1">, </span><span class="hl-2">apiKey:</span><span class="hl-1"> </span><span class="hl-3">&quot;noop&quot;</span><span class="hl-1"> })</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-0">addCompletion</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">completionName:</span><span class="hl-1"> </span><span class="hl-2">CompletionName</span><span class="hl-1">.</span><span class="hl-2">LMStudioCompletion</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">getCompletion:</span><span class="hl-1"> </span><span class="hl-2">Adapter</span><span class="hl-1">.</span><span class="hl-0">fromLMStudio</span><span class="hl-1">(</span><span class="hl-0">getOpenAI</span><span class="hl-1">(), </span><span class="hl-3">&quot;command_r_gguf&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>I’ll add that the local and cloud models behave identically, which is a huge plus since I don’t know how long this “fun carousel” will keep spinning...</p>
<a id="thank-you-for-your-attention" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Thank You for Your Attention!<a href="#thank-you-for-your-attention" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>I hope Cohere doesn’t find my little carousel too sad or financially burdensome :-(</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#cohere-command--the-revolution-we-missed"><span>Cohere <wbr/>Command — <wbr/>The <wbr/>Revolution <wbr/>We <wbr/>Missed</span></a><ul><li><a href="#search-results"><span>Search <wbr/>Results</span></a></li><li><ul><li><a href="#what-exactly-did-we-miss"><span>What <wbr/>Exactly <wbr/>Did <wbr/>We <wbr/>Miss?</span></a></li></ul></li><li><a href="#the-fun-carousel"><span>The <wbr/>Fun <wbr/>Carousel</span></a></li><li><a href="#thank-you-for-your-attention"><span>Thank <wbr/>You for <wbr/>Your <wbr/>Attention!</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">agent-swarm-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(100273846, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        ecommerce:"dataLayer"
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/100273846" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-85RYYZDT35"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-85RYYZDT35');
</script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(100273846, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        ecommerce:"dataLayer"
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/100273846" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-85RYYZDT35"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-85RYYZDT35');
</script>
