<!DOCTYPE html><html class="default" lang="en" data-base=".."><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>design/20_completion_adapters | agent-swarm-kit</title><meta name="description" content="Documentation for agent-swarm-kit"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search"><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">agent-swarm-kit</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../modules.html">agent-swarm-kit</a></li><li><a href="design_20_completion_adapters.html">design/20_completion_adapters</a></li></ul></div><div class="tsd-panel tsd-typography"><a id="completion-adapters" class="tsd-anchor"></a><h1 class="tsd-anchor-link">Completion Adapters<a href="#completion-adapters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h1><p>This document covers the completion adapter system that enables the agent-swarm-kit framework to integrate with various AI language model providers. The adapters provide a standardized interface for interacting with different completion APIs while handling provider-specific message formatting, tool calls, and response processing.</p>
<p>For information about performance monitoring of completions, see <a href="design_04_state_management.html">Performance Monitoring</a>. For broader AI integration patterns, see <a href="design_04_state_management.html">AI Integration</a>.</p>
<a id="overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The completion adapter system provides a unified interface for interacting with multiple AI providers through the AdapterUtils class. Each adapter transforms the framework's internal message format to the provider's expected format and processes responses back to the standard format.</p>
<p><img src="../media/20_Completion_Adapters_0.svg" alt="Mermaid Diagram"></p>
<a id="supported-providers" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Supported Providers<a href="#supported-providers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The framework supports five major AI providers through dedicated adapter methods:</p>
<table>
<thead>
<tr>
<th>Provider</th>
<th>Method</th>
<th>Default Model</th>
<th>Special Features</th>
</tr>
</thead>
<tbody>
<tr>
<td>OpenAI</td>
<td><code>fromOpenAI</code></td>
<td><code>gpt-3.5-turbo</code></td>
<td>Response format control</td>
</tr>
<tr>
<td>Grok</td>
<td><code>fromGrok</code></td>
<td><code>grok-3-mini</code></td>
<td><a href="http://X.AI">X.AI</a>'s Grok model</td>
</tr>
<tr>
<td>Cohere</td>
<td><code>fromCohereClientV2</code></td>
<td><code>command-r-08-2024</code></td>
<td>Cohere's V2 client</td>
</tr>
<tr>
<td>LMStudio</td>
<td><code>fromLMStudio</code></td>
<td><code>saiga_yandexgpt_8b_gguf</code></td>
<td>Local model hosting</td>
</tr>
<tr>
<td>Ollama</td>
<td><code>fromOllama</code></td>
<td><code>nemotron-mini:4b</code></td>
<td>Custom tool protocol</td>
</tr>
</tbody>
</table>
<a id="provider-specific-implementations" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Provider-Specific Implementations<a href="#provider-specific-implementations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="openai-adapter" class="tsd-anchor"></a><h4 class="tsd-anchor-link">OpenAI Adapter<a href="#openai-adapter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The fromOpenAI method handles OpenAI's chat completions API with optional response format control and standard tool calling support.</p>
<a id="grok-adapter" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Grok Adapter<a href="#grok-adapter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The fromGrok method interfaces with <a href="http://X.AI">X.AI</a>'s Grok API, using similar message formatting to OpenAI but with provider-specific configurations.</p>
<a id="cohere-adapter" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Cohere Adapter<a href="#cohere-adapter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The fromCohereClientV2 method transforms messages for Cohere's V2 client, handling different field naming conventions like <code>toolCallId</code> vs <code>tool_call_id</code>.</p>
<a id="lmstudio-adapter" class="tsd-anchor"></a><h4 class="tsd-anchor-link">LMStudio Adapter<a href="#lmstudio-adapter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The fromLMStudio method connects to LMStudio's OpenAI-compatible API for local model hosting scenarios.</p>
<a id="ollama-adapter" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Ollama Adapter<a href="#ollama-adapter" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The fromOllama method includes special handling for tool calls using the TOOL_PROTOCOL_PROMPT to instruct models on XML-based tool call formatting.</p>
<a id="message-transformation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Message Transformation<a href="#message-transformation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each adapter performs bidirectional message transformation between the framework's IModelMessage format and provider-specific formats.</p>
<p><img src="../media/20_Completion_Adapters_1.svg" alt="Mermaid Diagram"></p>
<a id="tool-call-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tool Call Handling<a href="#tool-call-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tool calls require special transformation because providers use different formats:</p>
<ul>
<li><strong>OpenAI/Grok/LMStudio</strong>: Native tool call support with JSON arguments</li>
<li><strong>Cohere</strong>: Uses <code>toolCalls</code> field with different structure</li>
<li><strong>Ollama</strong>: Uses XML-based protocol with TOOL_PROTOCOL_PROMPT</li>
</ul>
<p>The tool call transformation process:</p>
<ol>
<li><strong>Outbound</strong>: Framework tool calls → Provider format</li>
<li><strong>Inbound</strong>: Provider tool calls → Framework format with generated IDs</li>
</ol>
<a id="performance-and-reliability-features" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Performance and Reliability Features<a href="#performance-and-reliability-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="execution-pooling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Execution Pooling<a href="#execution-pooling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All adapters use execpool to limit concurrent requests:</p>
<ul>
<li><strong>Maximum concurrent executions</strong>: 5 EXECPOOL_SIZE</li>
<li><strong>Delay between executions</strong>: 0ms EXECPOOL_WAIT</li>
</ul>
<a id="retry-logic" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Retry Logic<a href="#retry-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Built-in retry mechanism with:</p>
<ul>
<li><strong>Maximum retries</strong>: 5 RETRY_COUNT</li>
<li><strong>Retry delay</strong>: 5000ms RETRY_DELAY</li>
</ul>
<a id="logging-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Logging Integration<a href="#logging-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Each adapter logs completion requests using Logger.logClient for debugging and monitoring.</p>
<p><img src="../media/20_Completion_Adapters_2.svg" alt="Mermaid Diagram"></p>
<a id="integration-with-agent-system" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Integration with Agent System<a href="#integration-with-agent-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The completion adapters integrate with the broader agent system through the dependency injection container and performance monitoring:</p>
<a id="service-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Service Integration<a href="#service-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Adapters are used by ClientAgent for message processing</li>
<li>Performance tracking via PerfService monitors completion metrics</li>
<li>Logging through LoggerService provides debugging capabilities</li>
</ul>
<a id="type-safety" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Type Safety<a href="#type-safety" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The TCompleteFn type ensures all adapters conform to the same interface:</p>
<pre><code class="typescript"><span class="hl-4">type</span><span class="hl-1"> </span><span class="hl-7">TCompleteFn</span><span class="hl-1"> = (</span><span class="hl-2">args</span><span class="hl-1">: </span><span class="hl-7">ICompletionArgs</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">IModelMessage</span><span class="hl-1">&gt;</span>
</code><button type="button">Copy</button></pre>

<a id="singleton-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Singleton Pattern<a href="#singleton-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The adapters are available through the Adapter singleton instance, providing a consistent entry point for the entire system.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#completion-adapters"><span>Completion <wbr/>Adapters</span></a><ul><li><a href="#overview"><span>Overview</span></a></li><li><a href="#supported-providers"><span>Supported <wbr/>Providers</span></a></li><li><ul><li><a href="#provider-specific-implementations"><span>Provider-<wbr/>Specific <wbr/>Implementations</span></a></li><li><ul><li><a href="#openai-adapter"><span>OpenAI <wbr/>Adapter</span></a></li><li><a href="#grok-adapter"><span>Grok <wbr/>Adapter</span></a></li><li><a href="#cohere-adapter"><span>Cohere <wbr/>Adapter</span></a></li><li><a href="#lmstudio-adapter"><span>LMStudio <wbr/>Adapter</span></a></li><li><a href="#ollama-adapter"><span>Ollama <wbr/>Adapter</span></a></li></ul></li></ul></li><li><a href="#message-transformation"><span>Message <wbr/>Transformation</span></a></li><li><ul><li><a href="#tool-call-handling"><span>Tool <wbr/>Call <wbr/>Handling</span></a></li></ul></li><li><a href="#performance-and-reliability-features"><span>Performance and <wbr/>Reliability <wbr/>Features</span></a></li><li><ul><li><a href="#execution-pooling"><span>Execution <wbr/>Pooling</span></a></li><li><a href="#retry-logic"><span>Retry <wbr/>Logic</span></a></li><li><a href="#logging-integration"><span>Logging <wbr/>Integration</span></a></li></ul></li><li><a href="#integration-with-agent-system"><span>Integration with <wbr/>Agent <wbr/>System</span></a></li><li><ul><li><a href="#service-integration"><span>Service <wbr/>Integration</span></a></li><li><a href="#type-safety"><span>Type <wbr/>Safety</span></a></li><li><a href="#singleton-pattern"><span>Singleton <wbr/>Pattern</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">agent-swarm-kit</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(100273846, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true,
        ecommerce:"dataLayer"
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/100273846" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-85RYYZDT35"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-85RYYZDT35');
</script>
